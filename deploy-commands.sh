#!/bin/bash

# hanguru.school ì„œë²„ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
# ì‚¬ìš©ë²•: ./deploy-commands.sh

echo "ğŸš€ hanguru.school Next.js ì•± ë°°í¬ ì‹œì‘"
echo "=================================="

# 1. íŒŒì¼ ì—…ë¡œë“œ
echo "ğŸ“¤ 1ë‹¨ê³„: íŒŒì¼ ì—…ë¡œë“œ"
echo "ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:"
echo "scp hanguru-app-deploy.tar.gz user@hanguru.school:/tmp/"
echo ""

# 2. ì„œë²„ ì ‘ì† ë° ì„¤ì •
echo "ğŸ”§ 2ë‹¨ê³„: ì„œë²„ ì„¤ì •"
echo "ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ì„¸ìš”:"
echo ""
echo "# ì„œë²„ ì ‘ì†"
echo "ssh user@hanguru.school"
echo ""
echo "# ë””ë ‰í„°ë¦¬ ìƒì„± ë° íŒŒì¼ ì´ë™"
echo "sudo mkdir -p /var/www/hanguru-app"
echo "sudo chown \$USER:\$USER /var/www/hanguru-app"
echo "cd /var/www/hanguru-app"
echo "tar -xzf /tmp/hanguru-app-deploy.tar.gz"
echo ""
echo "# ì˜ì¡´ì„± ì„¤ì¹˜"
echo "npm install --production"
echo ""
echo "# PM2 ì„¤ì¹˜ ë° ì‹¤í–‰"
echo "npm install -g pm2"
echo "pm2 start npm --name 'hanguru-app' -- start"
echo "pm2 startup"
echo "pm2 save"
echo ""

# 3. nginx ì„¤ì •
echo "ğŸŒ 3ë‹¨ê³„: nginx ì„¤ì •"
echo "nginx ì„¤ì • íŒŒì¼ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”:"
echo ""
echo "sudo nano /etc/nginx/sites-available/hanguru.school"
echo ""
echo "ë‹¤ìŒ ë‚´ìš©ì„ location / ë¸”ë¡ ë‹¤ìŒì— ì¶”ê°€:"
echo "=================================="
echo "    # Next.js ì•± (ì„œë¸Œ ë””ë ‰í„°ë¦¬)"
echo "    location /app/ {"
echo "        # ë¸Œë¼ìš°ì €ë§Œ í—ˆìš©"
echo "        if (\$http_user_agent !~* \"(Mozilla|Chrome|Safari|Edge|Opera|Firefox)\") {"
echo "            return 403;"
echo "        }"
echo "        "
echo "        # Next.jsë¡œ í”„ë¡ì‹œ"
echo "        proxy_pass http://localhost:3000;"
echo "        proxy_set_header Host \$host;"
echo "        proxy_set_header X-Real-IP \$remote_addr;"
echo "        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;"
echo "        proxy_set_header X-Forwarded-Proto \$scheme;"
echo "        "
echo "        # ë³´ì•ˆ í—¤ë”"
echo "        proxy_hide_header X-Powered-By;"
echo "        add_header X-Frame-Options \"DENY\" always;"
echo "        add_header X-Content-Type-Options \"nosniff\" always;"
echo "    }"
echo "=================================="
echo ""

# 4. nginx ì¬ì‹œì‘
echo "ğŸ”„ 4ë‹¨ê³„: nginx ì¬ì‹œì‘"
echo "sudo nginx -t"
echo "sudo systemctl reload nginx"
echo ""

# 5. í…ŒìŠ¤íŠ¸
echo "ğŸ§ª 5ë‹¨ê³„: ë°°í¬ í…ŒìŠ¤íŠ¸"
echo "ë‹¤ìŒ URLë¡œ ì ‘ì† í…ŒìŠ¤íŠ¸:"
echo "https://hanguru.school/app/"
echo ""
echo "ë¸Œë¼ìš°ì €ì—ì„œ ì •ìƒ ì ‘ì†ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!"
echo ""

echo "âœ… ë°°í¬ ì™„ë£Œ!"
echo "=================================="
echo "ì ‘ì† URL:"
echo "- ì›Œë“œí”„ë ˆìŠ¤: https://hanguru.school/"
echo "- Next.js ì•±: https://hanguru.school/app/"
echo "- IC ì¹´ë“œ ë“±ë¡: https://hanguru.school/app/tagging/home"
echo "- ê´€ë¦¬ì: https://hanguru.school/app/admin/"
echo "==================================" 